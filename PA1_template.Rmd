# Reproducible Research: Peer Assessment 1

##Loading required libraries

```{r Loading libraries}
#install.packages("ggplot2")
library(ggplot2)
library(knitr)
library(markdown)
library(impute)
library(xtable)
```

## Loading and preprocessing the data

```{r loading data}
acdat <-  read.csv(unz("activity.zip", "activity.csv"),
                   header = TRUE,
                   colClasses = c("numeric","POSIXct","numeric"))
```

## What is mean total number of steps taken per day?
In this section, an histogram present the distribution of the number of steps taken across all days. 
```{r steps per day}
stepsperday <- with(acdat,tapply(steps,date,sum,na.rm=T))
binw <- (range(stepsperday,na.rm = T)[2]-range(stepsperday,na.rm = T)[1])/30
qplot(stepsperday, binwidth =binw, xlab= "Steps per day", ylab = "Frequency")

```

It is important to notice that there exists a high frecuency of zeros on the histogram due to the lack of data (missing values) in some days. Those missing values will be imputed and the new histogram is presented in the next section.


The following table present the mean and median number of steps taken each day (empty boxes indicates missing data):

```{r men and median, results='asis'}
step_mean <- with(acdat,tapply(steps,date,mean,na.rm=T))
step_median <- with(acdat,tapply(steps,date,median,na.rm=T))
mm <- data.frame(step_mean, step_median)
xt <- xtable(mm)
print(xt, type= "html")  
```



## What is the average daily activity pattern?

```{r time series plot}
acdat$datetime <- acdat$date+acdat$interval*60
interAvg <- with(acdat, tapply(steps, interval,FUN = mean, na.rm =T)) 
interdf <- data.frame(interval = as.numeric(names(interAvg)),interAvg)
ggplot(data = interdf, aes(interval, interAvg)) + geom_line(color="steelblue",size=1)+ ylab("Number of steps") + xlab("Date/time")

maxd <- which.max(interdf$interAvg)
```

The 5-minute interval `r acdat[maxd,3]` on `r acdat[maxd,2]` contains the maximum number of steps (`r acdat[maxd,1]`).

## Imputing missing values

The orginal data contains some missing values`r sum(is.na(acdat$steps))`.

In order to perform an exploratory analysis, the missing values were imputed using the day average steps for all the data. The R code used is he following.


```{r missing valules,results='hide'}
acdat2 <- acdat  
acdat2$steps<- (impute.knn(as.matrix(cbind(acdat2$steps,acdat2$interval,as.numeric(acdat2$date))))$data)[,1]
```
```{r imputation plot}
stepsperday2 <- with(acdat2,tapply(steps,date,sum,na.rm=T))
binw2 <- (range(stepsperday2,na.rm = T)[2]-range(stepsperday2,na.rm = T)[1])/30
qplot(stepsperday2, binwidth =binw2, xlab= "Steps per day", ylab = "Frequency")


```

```{r men and median (imputed), results='asis'}
step_mean <- with(acdat2,tapply(steps,date,mean,na.rm=T))
step_median <- with(acdat2,tapply(steps,date,median,na.rm=T))
mm <- data.frame(step_mean, step_median)
xt <- xtable(mm)
print(xt, type= "html")  
```

After imputing the missing values the mean and median are `r sprintf("%.2f",means2)` and `r sprintf("%.2f",medians2)`, respectively.

## Are there differences in activity patterns between weekdays and weekends?

The activity patters differ btween weekends and midweek. this can be observe in the following plot.

```{r weekdays}
weekend <- c(weekdays(as.Date(c("19072014","20072014"),format="%d%m%Y")))
acdat2$weekday <- ifelse(weekdays(acdat2$date) %in% weekend, "weekend", "weekday")
acdat2$weekday <- as.factor(acdat2$weekday)
interAvg2 <- aggregate(acdat2$steps,by = list(acdat2$weekday,acdat2$interval),mean,na.rm=T)
ggplot(interAvg2, aes(Group.2,x)) + geom_line(color = "steelblue", size =1) + facet_wrap(~ Group.1,2) + xlab(label = "Interval") + ylab("Number fo steps")

```


